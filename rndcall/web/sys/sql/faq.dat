########################################################################### 
# ���� Query
###########################################################################
#==============================================================
# ÷������ seq��ȸ
#==============================================================
@sql.faq.getFileSeq
SELECT RNDCALL_FILE_ID_SEQ.NEXT_VALUE AS ID  
#==============================================================
# seq��ȸ
#==============================================================
@sql.faq.getSeq
SELECT RNDCALL_QUESTION_SEQ.NEXT_VALUE AS ID 
#==============================================================
# ÷������ ���
#=============================================================== 
@sql.faq.getAttachfileInsert
INSERT INTO RNDCALL_FILE (
   	FILE_ID,
	SEQ,
	FILE_NM,
	FILE_UP_PATH,
	FILE_SIZE,
	FILE_DEL_YN,
	REG_ID,
	REG_DT
)VALUES (
	?,
    ?,
    ?,
    ?,
    ?,
    'N',
    ?,
	sysdatetime
)
#==============================================================
# FAQ���
#==============================================================
@sql.faq.faqinsert
INSERT INTO RNDCALL_BOARD_QUESTION (
	SEQ,             BOARD_TYPE,       TITLE,            CONTENTS,
	CELL_RECEIVE_YN, CELL_NUMBER,      EMAIL_RECEIVE_YN, EMAIL,
	OPEN_YN,         PUBLIC_TRANS_YN, PUBLIC_TRANS_ID,  INSERT_TYPE,
	NTIS_REG_ID,     FILE_ID,          DEL_YN,           READ_COUNT,
	REG_ID,          REG_DT,           REG_NM,           CATEGORY1,
	CATEGORY2,		 ANALYSIS_YN
) VALUES (
	?, ?, ?, CHAR_TO_CLOB(?),
	?, ?, ?, ?,
	?, ?, ?,  ?,
	?, ?, ?, 0,
	?, sysdatetime, ?, ?,
	?, ?
)
#==============================================================
# RNDCALL_FILE��ȸ
#==============================================================
@sql.faq.question.fileinfo
SELECT FILE_ID,   SEQ,          FILE_NM,
       FILE_TYPE, FILE_UP_PATH, FILE_DOWN_PATH,
       FILE_SIZE, FILE_DESC,    FILE_DEL_YN
FROM RNDCALL_FILE
WHERE FILE_ID = ?
      AND FILE_DEL_YN='N'
#==============================================================
# seq��ȸ
#==============================================================
@sql.faq.getFaqSeq
SELECT RNDCALL_ANSWER_SEQ.NEXT_VALUE AS ID 
#==============================================================
# FAQ�亯���
#==============================================================
@sql.faq.faqAnswerInsert
INSERT INTO RNDCALL_BOARD_ANSWER (
	SEQ,             
	Q_SEQ,
	TITLE,  
	REG_ID,
	ANSWER_CONT,
	REG_DT
) VALUES (
	?,
	?,
	?,
	?,
	CHAR_TO_CLOB(?),
	sysdatetime
)
#==============================================================
# FAQ�亯��� �ٸ����
#==============================================================
@sql.faq.faqAnswerInsert2
INSERT INTO RNDCALL_BOARD_ANSWER (
   TITLE, 
   SEQ, 
   REG_ID, 
   REG_DT, 
   Q_SEQ, 
   EDIT_ID, 
   EDIT_DT,
   DEL_YN, 
   ANSWER_CONT) 
VALUES ( null,
 		 ?,
         ?,
         sysdatetime,
         ?,
		 null,
		 null,
		 'N',
		  CHAR_TO_CLOB(?)
		)
#==============================================================
# FAQ����Ʈ ��ȸ
#==============================================================
@sql.faq.faqList
SELECT
	A.SEQ as seq,
	A.TITLE as title,
	CLOB_TO_CHAR(A.CONTENTS) as contents,
	A.READ_COUNT as read_count,
	(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY1) as CATEGORY1,
	(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY2) as CATEGORY2,
	DECODE(A.SEQ,null,'N','Y') AS STAT,
	TO_CHAR(A.REG_DT, 'YYYY.MM.DD')AS reg_dt,
	A.REG_NM AS reg_nm,
	CLOB_TO_CHAR(B.ANSWER_CONT) as answer_cont,
	A.ANALYSIS_YN
FROM RNDCALL_BOARD_QUESTION A, RNDCALL_BOARD_ANSWER B
where a.seq = b.q_seq
AND A.DEL_YN = 'N'
#==============================================================
# FAQ������Ʈ������ ��ȸ
#==============================================================
@sql.faq.faqUpdateRetrieve
SELECT
	A.SEQ as seq,
	A.TITLE as title,
	A.READ_COUNT as read_count,
	(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY1) as CATEGORY1,
	(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY2) as CATEGORY2,
	DECODE(A.SEQ,null,'N','Y') AS STAT,
	TO_CHAR(A.REG_DT, 'YYYY.MM.DD')AS reg_dt,
	A.REG_NM AS reg_nm,
	A.BOARD_TYPE AS board_type,
	CLOB_TO_CHAR(A.CONTENTS) as contents,
	CLOB_TO_CHAR(B.ANSWER_CONT) as answer_cont,
	F.FILE_ID AS file_id,
	A.ANALYSIS_YN
FROM RNDCALL_BOARD_QUESTION A LEFT OUTER JOIN RNDCALL_BOARD_ANSWER B ON A.SEQ = B.Q_SEQ
     LEFT OUTER JOIN RNDCALL_FILE F ON A.FILE_ID = F.FILE_ID
#==============================================================
# FAQ����ȸ
#==============================================================
@sql.faq.faqDetailList
SELECT
       A.SEQ as seq,
       A.TITLE as title,
       CLOB_TO_CHAR(A.CONTENTS) as contents,
       A.BOARD_TYPE AS board_type,
       TO_CHAR(A.REG_DT, 'YYYY.MM.DD')AS reg_dt,
       B.ANSWER_CONT as answer_cont,
       F.FILE_ID AS file_id,
		(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY1) as CATEGORY1,
		(SELECT CATEGORY_NM FROM RNDCALL_CATEGORY WHERE CATEGORY_ID = A.CATEGORY2) as CATEGORY2,
       A.ANALYSIS_YN
  FROM RNDCALL_BOARD_QUESTION A LEFT OUTER JOIN RNDCALL_BOARD_ANSWER B ON A.SEQ = B.Q_SEQ
                                LEFT OUTER JOIN RNDCALL_FILE F ON A.FILE_ID = F.FILE_ID
 WHERE A.DEL_YN='N'
  
#==============================================================
# FAQ��ȸ�� ����
#==============================================================
@sql.faq.faqReadcount
SELECT INCR(read_count)
  FROM RNDCALL_BOARD_QUESTION 
 WHERE seq = ?
#==============================================================
# �������� ���� ��ȸ
#==============================================================
@sql.faq.pointRetrieve
SELECT ROUND(AVG(app_point),1) AS AVG_APP_POINT  FROM RNDCALL_SATI
WHERE WRITE_ID = ?
#==============================================================
# �������� �Ǽ� ��ȸ
#==============================================================
@sql.faq.CountRetrieve
SELECT COUNT(*) AS SATI_REG_CNT  FROM RNDCALL_SATI
WHERE WRITE_ID = ?
#==============================================================
# �������� ��Ͽ���
#==============================================================
@sql.faq.createYN
SELECT DECODE(COUNT(*),0,'N','Y') AS SATI_REG_YN  FROM RNDCALL_SATI
WHERE WRITE_ID = ?
      AND REG_ID = ?
#==============================================================
# ������ �� seq��ȸ
#==============================================================
@sql.faq.getSatiSeq
SELECT RNDCALL_SATI_SEQ.NEXT_VALUE AS ID 
#==============================================================
# ������ �� ���
#==============================================================
@sql.faq.satiInsert
INSERT INTO RNDCALL_SATI (
	SATI_ID, WRITE_ID, BOARD_TYPE, 
	REG_ID, APP_POINT, REG_IP, REG_DT
)VALUES(
	?, ?, ?, 
	?, ?, ?, sysdatetime
)
#==============================================================
# FAQ�� �����Ѵ�(FAQ���̺�).
#==============================================================
@sql.faq.faqUpdate
UPDATE RNDCALL_BOARD_QUESTION SET
TITLE = ?,
CONTENTS = CHAR_TO_CLOB(?),
EDIT_ID = ?,
EDIT_DT =sysdatetime,
FILE_ID = ?,
ANALYSIS_YN = ?
WHERE SEQ = ?
#==============================================================
# FAQ�� �����Ѵ�(FAQ�亯���̺�).
#==============================================================
@sql.faq.faqUpdateAnswer
UPDATE RNDCALL_BOARD_ANSWER SET
	TITLE = ?,
	ANSWER_CONT = CHAR_TO_CLOB(?),
	EDIT_ID = ?,
	EDIT_DT =sysdatetime
WHERE Q_SEQ = ?
#==============================================================
# FAQ�� �����Ѵ�(FAQ���̺�).
#==============================================================
@sql.faq.faqDelete
UPDATE RNDCALL_BOARD_QUESTION SET
    DEL_YN = 'Y' 
WHERE SEQ = ?
#==============================================================
# FAQ�� �����Ѵ�(FAQ�亯���̺�).
#==============================================================
@sql.faq.faqDeleteAnswer
UPDATE RNDCALL_BOARD_ANSWER SET
    DEL_YN = 'Y' 
WHERE Q_SEQ = ?
#==============================================================
# ��з� �ڵ�
#=============================================================== 
@sql.faq.question.Category1Code_old
SELECT CD_DTL_ID AS code 
     , CD_DTL_NM AS code_nm  
  FROM RNDCALL_CODE 
 WHERE CD_ID = '100'
   AND SUBSTR(CD_DTL_ID,5,7) = '000'
 ORDER BY CODE
 
 
 #==============================================================
# ��з� �ڵ�
#=============================================================== 
@sql.faq.question.Category1Code
SELECT a.CATEGORY_ID AS code,
       a.CATEGORY_NM AS code_nm 
FROM RNDCALL_CATEGORY a
WHERE a.TREE_LEVEL = '1'
	  AND a.ISUSE = 'Y'
ORDER BY  a.CATEGORY_ID

#==============================================================
# �Һз� �ڵ�
#=============================================================== 
@sql.faq.question.Category2Code 
SELECT a.CATEGORY_ID AS code,
       a.CATEGORY_NM AS code_nm ,
       a.PARENT_ID AS p_code
FROM RNDCALL_CATEGORY a
WHERE a.TREE_LEVEL = '2'
	  AND a.ISUSE = 'Y'
ORDER BY  a.CATEGORY_ID

#==============================================================
# �̸��� ���ų��� ����
#=============================================================== 
@sql.faq.question.getSendHistoryInsert
INSERT INTO RNDCALL_SEND_HISTORY(
	SEQ,       GUBUN,      BOARD_TYPE, 
	REG_EMAIL, CALL_EMAIL, MESSAGE,
	REG_ID,     REG_DT, SMS_Y
)VALUES(
	?, ?, ?,
	?, ?, ?, 
	?, sysdatetime, 'Y'
) 
#==============================================================
# �̸��� ���ų��� ����
#=============================================================== 
@sql.faq.question.getSendHistoryInsertCellPhone
INSERT INTO RNDCALL_SEND_HISTORY(
	SEQ,       GUBUN,      BOARD_TYPE, 
	REG_PHONE, CALL_PHONE, MESSAGE,
	REG_ID,     REG_DT, SMS_Y
)VALUES(
	?, ?, ?,
	?, ?, ?, 
	?, sysdatetime, 'Y'
) 
#==============================================================
# ÷������ ����(FILE_DEL_YN�÷���  ����(Y)�� ������Ʈ)
#=============================================================== 
@sql.faq.question.getFileDelete
UPDATE RNDCALL_FILE SET
FILE_DEL_YN = 'Y',
EDIT_ID= ?,
EDIT_DT =sysdatetime
WHERE FILE_ID=? 
      AND SEQ= ?
#==============================================================
# sms
#=============================================================== 
@sql.faq.question.view
select call_phone, message, sms_y from rndcall_send_history where sms_y = 'Y'
#==============================================================
# ��ó����� ����Ʈ ��ȸ
#=============================================================== 
@sql.faq.question.orgUserinfo
select name AS NAME, 
auth_id AS AUTH_ID,
user_id AS USER_ID,
org_nm AS ORG_NM,
auth AS AUTH ,
DECODE(NVL(MOBILE,''), '', TEL, MOBILE) AS TEL,
NVL(EMAIL,'@') AS EMAIL
from rndcall_auth
where auth = '0000B'