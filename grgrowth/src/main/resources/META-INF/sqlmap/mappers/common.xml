<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.grgrowth.common.service.impl.CommonMapper">

	<!-- 카테고리 상세정보 -->
	<select id="categoryView" resultType="egovframework.grgrowth.common.service.CommonCategoryVO">
	    <![CDATA[
			SELECT
				A.CATEGORY_SEQ
				, A.CATEGORY_NM
				, DATE_FORMAT(A.REGDATE, "%Y/%m/%d") REGDATE
				, A.USE_YN 
			FROM TB_CATEGORY A
			WHERE 1=1
				AND A.USE_YN = 'Y'
	    ]]>
		    <if test="category_seq != null">
				AND A.CATEGORY_SEQ = #{ category_seq }
			</if>
	</select>
	
	<!-- 게시판 목록 -->
	<select id="boardList" resultType="egovframework.grgrowth.common.service.CommonBoardVO">
	    <![CDATA[
			SELECT
				A.BOARD_SEQ
				, A.TITLE
				, A.CONTENT
				, DATE_FORMAT(A.REGDATE, "%Y/%m/%d") REGDATE
				, A.FILE_SEQ
				, A.CATEGORY_SEQ
				, B.CATEGORY_NM
			FROM TB_BOARD A
			INNER JOIN TB_CATEGORY B
				ON B.CATEGORY_SEQ = A.CATEGORY_SEQ
				AND B.USE_YN = 'Y'
			WHERE 1=1
				AND A.USE_YN = 'Y'
	    ]]>
		    <if test="category_seq != null">
				AND A.CATEGORY_SEQ = #{ category_seq }
			</if>
		<![CDATA[		
			ORDER BY A.BOARD_SEQ DESC
			LIMIT #{ recordCountPerPage } OFFSET #{ firstIndex }
		]]>
	</select>

	<!-- 게시판 목록 개수 -->
	<select id="boardListTotCnt" resultType="int">
	    <![CDATA[
			SELECT
				COUNT(*)
			FROM TB_BOARD A
			INNER JOIN TB_CATEGORY B
				ON B.CATEGORY_SEQ = A.CATEGORY_SEQ
				AND B.USE_YN = 'Y'
			WHERE 1=1
				AND A.USE_YN = 'Y'
	    ]]>
		    <if test="category_seq != null">
				AND A.CATEGORY_SEQ = #{ category_seq }
			</if>
	</select>
	
	<resultMap id="boardViewResultMap" type="egovframework.grgrowth.common.service.CommonBoardVO">
		<result property="file_seq" column="FILE_SEQ" />
		<collection property="fileInfoList" javaType="ArrayList" column="FILE_SEQ" ofType="egovframework.grgrowth.common.service.FileInfoVO" select="fileInfoList"/>
	</resultMap>
	
	<!-- 게시판 상세정보 -->
	<select id="boardView" resultMap="boardViewResultMap">
		<![CDATA[
			SELECT
				A.BOARD_SEQ
				, A.TITLE
				, A.CONTENT
				, DATE_FORMAT(A.REGDATE, "%Y/%m/%d") REGDATE
				, A.FILE_SEQ
				, A.CATEGORY_SEQ
				, B.CATEGORY_NM
			FROM TB_BOARD A
			INNER JOIN TB_CATEGORY B
				ON B.CATEGORY_SEQ = A.CATEGORY_SEQ
				AND B.USE_YN = 'Y'
			WHERE 1=1
				AND A.USE_YN = 'Y'
				AND A.BOARD_SEQ = #{ board_seq }
	    ]]>
	</select>
	
	<!-- 첨부파일 목록 -->
	<select id="fileInfoList" resultType="egovframework.grgrowth.common.service.FileInfoVO">
		<![CDATA[
			SELECT
				A.FILE_SEQ
				, A.FILE_SN
				, A.FILE_STRE_COURS
				, A.STRE_FILE_NM
				, A.ORIGNL_FILE_NM
				, A.FILE_EXTSN
				, A.FILE_CN
				, A.FILE_SIZE 
			FROM TB_FILE_DETAIL A
			INNER JOIN TB_FILE B
				ON B.FILE_SEQ = A.FILE_SEQ
			WHERE
				A.FILE_SEQ = #{ file_seq }
		]]>
			<if test="file_sn != null">
				AND A.FILE_SN = #{ file_sn }
			</if>	
	</select>
</mapper>
